# 4.2 ERD와 정규화 과정

**`ERD(Entity Relationship Diagram)`**

: 데이터베이스를 구축할 때 가장 기초적인 뼈대 역할, 릴레이션 간의 관계들을 정의

## 4.2.1 ERD의 중요성

- ERD는 시스템의 요구사항을 기반으로 작성
- ERD를 기반으로 데이터 베이스를 구축
- 관계형 구조로 표현할 수 있는 테이블을 구성하는데 유용
- **비정형 데이터를 충분히 표현할 수 없다는 단점**
    - 비정형 데이터 : 비구조화 데이터. 미리 정의된 데이터 모델이 없거나 미리 정의된 방식으로 정리되지 않은 정보

## **4.2.2 예제로 배우는 ERD**

### 승원 영업부서의 ERD

요구사항

- 영업사원은 0~n 명의 고객을 관리
- 고객은 0~n 개의 주문을 넣을 수 있다.
- 주문에는 1~n개의 상품이 들어간다.
<details>
  <summary> 정답 </summary>
  <img src="https://github.com/user-attachments/assets/f6c84773-3097-4959-81ac-32785730c31e" width="700px" />
</details>
 

### **무무오브레전드의 ERD**

요구사항

- 선수들은 1명의 챔피언을 고를 수 있음.
- 챔피언은 한 개 이상의 스킬을 가짐
- 스킬은 한 개 이상의 특성을 가짐.
<details>
  <summary> 정답 </summary>
  <img src="https://github.com/user-attachments/assets/f72a6c37-e054-4f45-a866-bc6a8f43548e" width="700px" />
</details>


## **4.2.3 정규화 과정**

- 릴레이션 간의 잘못된 종속 관계로 인해 데이터베이스 **이상 형상**이 일어나서 이를 해결하기 위함
- 저장 공간을 효율적으로 사용하기 위해 릴레이션을 여러 개로 분리하는 과정
- 정규형 원칙을 기반으로 정규형을 만들어 가는 과정
- 정규화된 정도는 정규형 Normal Form(NF)로 표현
    - 기본 정규형(제1정규형,제2정규형,제3정규형)
    - 보이스/코드 정규형 (BCNF)
    - 고급 정규형(제4정규형, 제5정규형)

<aside>
💡

**데이터베이스 이상 현상 (Anomaly)**

불필요한 데이터 중복으로 인해 릴레이션에 대한 데이터 삽입, 수정, 삭제 연산을 할 때 발생할 수 있는 부작용

- 삽입 이상: 데이터를 삽입하기 위해 불필요한 데이터도 함께 삽입해야 하는 문제
- 갱신 이상: 중복 튜플 중 일부만 변경하여 데이터가 불일치하게 되는 문제
- 삭제 이상: 튜플을 삭제하면 꼭 필요한 데이터까지 삭제되는 데이터 손실 문제
</aside>

### 정규화 원칙

- 같은 의미를 표현하는 릴레이션이지만 `더 좋은 구조`로 만들어야한다.
- 자료의 `중복성은 감소`해야한다.
- `독립적인 관계는 별개의 릴레이션`으로 표현해야한다.
- 각각의 릴레이션은 `독립적인 표현`이 가능해야 한다.

### 제 1정규형 (1NF)

- 릴레이션의 모든 도메인이 더 이상 분해될 수 없는 `원자 값(atomic value)`만으로 구성되어야 함
- 릴레이션의 속성 값 중에서 `한개의 기본키`에 대해 `두 개 이상의 값`을 가지는 반복집합이 있으면 안됨
    - 반복 집합이 있다면 제거해야 함
- 예시
    
    
    | 유저번호 | 유저 ID | 수강명 | 성취도 |
    | --- | --- | --- | --- |
    | 1 | 홍철 | {c++코딩테스트, 프런트 특강} | {90%, 10%} |
    | 2 | 범석 | {코드포스특강, DS 특강} | {7%, 8%} |
- 1정규형 적용
    
    
    | 유저번호 | 유저 ID | 수강명 | 성취도 |
    | --- | --- | --- | --- |
    | 1 | 홍철 | c++코딩테스트 | 90% |
    | 1 | 홍철 | 프런트 특강 | 10% |
    | 2 | 범석 | 코드포스특강 | 7% |
    | 2 | 범석 | DS 특강 | 8% |

### 제 2정규형 (2NF)

- 릴레이션이 제1정규형이며 `부분 함수의 종속성을 제거`한 형태
    - 부분함수의 종속성 제거: 기본키가 아닌 모든 속성이 기본키에 완전 함수 종속적인 것
- 2정규형 적용
    - 유저 번호 릴레이션
        
        
        | 유저번호 | 유저 ID |
        | --- | --- |
        | 1 | 홍철 |
        | 2 | 범석 |
    - 성취도 릴레이션
        
        
        | 유저 ID | 수강명 | 성취도 |
        | --- | --- | --- |
        | 홍철 | c++코딩테스트 | 90% |
        | 홍철 | 프런트 특강 | 10% |
        | 범석 | 코드포스특강 | 7% |
        | 범석 | DS 특강 | 8% |
    - 기본키인 {유저 ID, 수강명}과 완전 종속 된 유저번호 릴레이션과  성취도 릴레이션으로 분리

<aside>
⚠️

- 릴레이션을 분해할 때 동등한 릴레이션으로 분해해야 함
- 정보손실이 발생하지않는 무손실 분해로 분해되어야 함
- 릴레이션 분해 참고 - [https://gamedoridori.tistory.com/165](https://gamedoridori.tistory.com/165)
</aside>

### **제3정규형**

- 제2정규형이고 기본키가 아닌 모든 속성이 `이행적 함수 종속(transitive FD)`을 만족하지 않는 상태
    - 이행적 함수 종속 : A→B, B→C이면 논리적으로 A→C가 성립. 이 때 집합C가 집합A에 이행적으로 함수 종속이 되었다고 함
- 예시
    
    
    | 유저 ID | 등급 | 할인율 |
    | --- | --- | --- |
    | 홍철 | 플레티넘 | 30% |
    | 범수 | 다이아 | 50% |
    | 가영 | 마스터 | 70% |
- 3정규형 적용
    - 유저 테이블
        
        
        | 유저 ID | 등급 |
        | --- | --- |
        | 홍철 | 플레티넘 |
        | 범수 | 다이아 |
        | 가영 | 마스터 |
    - 등급 테이블
        
        
        | 등급 | 할인율 |
        | --- | --- |
        | 플레티넘 | 30% |
        | 다이아 | 50% |
        | 마스터 | 70% |
    - `유저 ID`는 `등급`에만 종속되고, `할인율`은 `등급`에만 종속되므로 이행적 종속성이 제거됨

### **보이스/코드 정규형 (BCNF)**

- 제3정규형이고, `결정자`가 후보키가 아닌 함수 종속 관계를 제거하여 릴레이션의 함수 종속 관계에서 모든 결정자가 후보키인 상태
    - 결정자 : 함수 종속 관계에서 특정 종속자를 결정짓는 요소
    - X→Y 에서 X는 결정자, Y는 종속자
- 예시
    - 각 수강명에 대해 한 학생은 오로지 한 강사의 강의만 수강
    - 각 강사는 한 수강명만 담당
    - 한 수강명은 여러 강사가 담당 할 수 있음
    
    | 학번 | 수강명 | 강사 |
    | --- | --- | --- |
    | 12010 | 코딩테스트 | 큰돌 |
    | 12010 | MEVN | 재엽 |
    | 12011 | 코딩테스트 | 큰돌 |
    | 12011 | MEVN | 가영 |
    | `NULL` | 롤 | 범석 |
    - 삽입 이상 발생!!!!
    - {학번, 수강명} 또는 {수강명, 강사} 가 후보키가 됨 → 함수 종속 관계
        - `학번, 수강명 → 강사` (각 학생의 수강명은 특정 강사에게 종속됨)
        - `강사 → 수강명` (각 강사는 하나의 수강명만 담당함)
    - 즉, 강사 속성이 결정자이지만 후보키가 아니므로 강사 속성을 분리해야 함.
- BCNF 적용
    - 학생-강사 테이블
        
        
        | 학번 | 강사 |
        | --- | --- |
        | 12010 | 큰돌 |
        | 12010 | 재엽 |
        | 12011 | 큰돌 |
        | 12011 | 가영 |
    - 강사-수강명 테이블
        
        
        | 수강명 | 강사 |
        | --- | --- |
        | 코딩테스트 | 큰돌 |
        | MEVN | 재엽 |
        | MEVN | 가영 |
        | 롤 | 범석 |
